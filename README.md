# Web Server with custom video and audio player #

## For what this is ##
This web server facilitates file sharing via a web browser, allowing users to stream videos, music, and other file types.    
It supports file uploads, creation, and deletion, all managed under a single "write" permission group. Access control is
handled through ACLs (Access Control Lists), enabling administrators to set permissions for each resource.
Users can be granted or denied read-only access, write permissions (upload, create, delete), or complete access restriction to specific resources.   

## Multimedia (video) ##
 - All video/audio codecs supported by the browser (this server does not use transcoding)
 - Uses caching to avoid calling ffmpeg too many times.
 - Ability to change audio track (enable experimental web platform features)
 - SSA/ASS subtitles support by using JASSUB on the client    
 - Convert SSA in a safe way to webVTT, to do it hold the settings button
 - Extract embeded subtitles in a video container like .mkv, mp4, etc.
 - Loads subtitles from an external .mks file with the same name as the video.    
   Note: it will disable all subtitles from the original video file.
 - Main video container must contain all metadata and audio tracks.

## ACL permissions and Users ##
  Both ACLs and users are managed through a script called aclmgr.py, located in the app directory.    
  See the [documentation](aclmgr.md) for how to use it.

## Extra ##
Also if an html file with extension ```.web``` will actuate as an HTML page as .html is interpreted as plain text by default.
    
If inside a folder there is a file ```index.web``` it will be autoloaded when opening the folder.  
It wont work on text-based or old browsers (MSIE), to force disable add ```?noauto``` to the folder URL.

## Requirements: ##
 Install all requirements with
 ```pip install -r requirements.txt```    
 For the video player to work: ```ffmpeg``` (as system package)

## Config ##
The following environment variables are used to configure the server:

  - SERVE_PATH   (required/mandatory):    
      Specifies the directory that will be served.

  - ERRLOG_FILE  (optional, default: data/error.log):     
      Defines the file where server error logs will be stored.

  - ACL_FILE     (optional, default: data/acl.json):    
      Specifies the file that contains the Access Control List (ACL) rules.

  - USERS_FILE   (optional, default: data/users.json):    
      Specifies the file where user account data is stored.

  - SESSIONS_DB  (optional, default: data/sessions db):    
      Defines the file used for storing session-related data.

  - SECRET_KEY   (optional, default: autogenerated):    
      Defines the secret key, useful in scenarios with multiworkers.

  - SHOW_DIRSIZE (optional, default: False):    
      If set to True, the server will display the total size of directories.

  - MAX_CACHE    (optional, default: 256) [per process]:   
      Specify the max RAM (in MB) used for metadata/subs caching for videos.


## To run the web server: ##  
   **If using a reverse proxy ensure that POST buffering is disabled, in NGINX is proxy_request_buffering off;**     
   
  - To run via flask internal HTTP server via CLI (will run in localhost and port 8000)    
    ```python3 app.py```

  - To use a WSGI for deployment -> (for example gunicorn)    
    ```gunicorn -b IP_addr app:app```
